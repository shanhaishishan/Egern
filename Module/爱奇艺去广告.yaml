#!name=爱奇艺
#!desc=悦享品质
#!author=RuCu6[https://github.com/RuCu6]
#!icon=https://raw.githubusercontent.com/sooyaaabo/Loon/main/Icon/App-Icon/IQIYI.png
#!openUrl=https://apps.apple.com/app/id393765873
#!tag=去广告
#!homepage=https://github.com/sooyaaabo/Egern
#!date=2025-05-13 22:00

[Rule]
# 放行地址
DOMAIN-SUFFIX,cupid.iqiyi.com,DIRECT
# 拦截地址
DOMAIN,api.iqiyi.com,REJECT
DOMAIN,access.if.iqiyi.com,REJECT
IP-CIDR,103.44.59.54/32,REJECT,no-resolve
IP-CIDR,111.63.147.158/32,REJECT,no-resolve
IP-CIDR,116.211.198.237/32,REJECT,no-resolve

https://www.grammarly.com/ai/ai-writing-tools/paragraph-rewriter
# body rewrite (需要先进行 URL Rewrite 才能执行 Body Rewrite)
# 这些 URL Rewrite 通常在 Egern 中不是必需的，因为 Body Rewrite 可以直接作用于响应体。
# 如果 Egern 的 Body Rewrite 无法直接匹配原始 URL，才需要考虑这些。
# 但对于本例，直接在 Body Rewrite 中使用正则表达式匹配更常见。

[HTTP Response]
# body rewrite
^https?://cards.iqiyi.com/views_home/3.0/qy_home\? url-regex delpaths([["base","statistics"]])
^https?://cards.iqiyi.com/views_home/3.0/qy_home\? url-regex del(.cards[] | select(.alias_name == "focus" or .alias_name == "ad_mobile_flow" or .alias_name == "ad_trueview"))
^https?://cards.iqiyi.com/views_category/3.0/category_home\? url-regex del(.base.statistics | select(.ad_str)) | del(.cards[] | select(.alias_name == "entrence_focus" or .alias_name == "ad_trueview"))
^https?://cards.iqiyi.com/waterfall(-plt)?/3.0/feed\? url-regex del(.base.statistics | select(.ad_str)) | del(.. | select(.block_class?))
^https?://cards.iqiyi.com/views_plt/3.0/player_tabs_v2\? url-regex .kv_pair.activity_tab |= (fromjson | map(select(.tab_text=="包场")) | tojson)
^https?://cards.iqiyi.com/views_plt/3.0/player_tabs_v2\? url-regex del(.cards[] | select(.alias_name == "play_vip_promotion" or .alias_name == "play_detail_tag" or .alias_name == "play_chat_entrance" or .alias_name == "play_ad_no_vip" or .alias_name == "play_vertical_short_video" or .alias_name == "play_rap_custom" or .alias_name == "play_topical_tab" or .alias_name == "play_vertical" or .alias_name == "play_water_fall_like")) | del(.. | select(.block_class?))
^https?://comment-card.iqiyi.com/views_comment/3.0/long_video_comments\? url-regex ""
^https?://cards.iqiyi.com/views_search/3.0/hot_query_search\? url-regex .cards |= map(select(.alias_name as $name | $name != "ad_trueview" and $name != "ad_mobile_flow" and $name != "search_mid_text_ad")) | if .base.statistics.ad_str? then del(.base.statistics) else . end
^https?://comment-card.iqiyi.com/views_comment/3.0/long_video_comments\? url-regex .cards |= map(select(has("alias_name")))
^https?://iface2.iqiyi.com/views_menus/3.0/bottom_theme\? url-regex delpaths([["theme_list"]])
^https?://iface2.iqiyi.com/views_menus/3.0/bottom_theme\? url-regex .cards |= map(.items |= map(select(.other.bottom_tab_type == "rec" or .other.bottom_tab_type == "vip" or .other.bottom_tab_type == "my")))
^https?://iface2.iqiyi.com/views_menus/3.0/home_top_menu\? url-regex .nav_group_data[].nav_list |= map(select(. == "0" or . == "2" or . == "1" or . == "6" or . == "4"))
^https?://iface2.iqiyi.com/fusion/3.0/common_switch\? url-regex delpaths([["content","resource","cast_device_ad"]])
^https?://iface2.iqiyi.com/fusion/3.0/common_switch\? url-regex if (getpath(["content","switchs","app_ad"]) | has("app_ad_enable")) then (setpath(["content","switchs","app_ad","app_ad_enable"]; 0)) else . end
^https?://iface2.iqiyi.com/fusion/3.0/common_switch\? url-regex if (getpath(["content","switchs","app_ad"]) | has("app_ad_duration")) then (setpath(["content","switchs","app_ad","app_ad_duration"]; 0)) else . end
^https?://iface2.iqiyi.com/fusion/3.0/common_switch\? url-regex if (getpath(["content","switchs","ios_tech"]) | has("kPreadAdHintSwitch")) then (setpath(["content","switchs","ios_tech","kPreadAdHintSwitch"]; 0)) else . end
^https?://iface2.iqiyi.com/fusion/3.0/common_switch\? url-regex if (getpath(["content","switchs","ios_tech"]) | has("ad_download")) then (setpath(["content","switchs","ios_tech","ad_download"]; 0)) else . end
^https?://iface2.iqiyi.com/fusion/3.0/common_switch\? url-regex if (getpath(["content","switchs","m_qiyi_ios_tech"]) | has("KFocusAdVideoPlayTimesIn4G")) then (setpath(["content","switchs","m_qiyi_ios_tech","KFocusAdVideoPlayTimesIn4G"]; 0)) else . end
^https?://(kjp|t7z).cupid.iqiyi.com/mixer\? url-regex delpaths([["adSlots"]])
^https?://search.video.iqiyi.com/q\? url-regex delpaths([["data"]])
^https?://iface2.iqiyi.com/aggregate/3.0/getMyMenus\? url-regex .data |= map(select(.statistic.block != "wd_liebiao_2") | select(all(.menuList[]?.statistic2.block; . != "wd_liebiao_3")))

[Map Local]
# url-regex 后面跟的是正则表达式，response-body 后面是响应体内容
^https?://iface2.iqiyi.com/control/3.0/init_proxy\? url-regex response-body ""
^https?://act.vip.iqiyi.com/interact/api/v2/show\? url-regex response-body ""
^https?://iface2.iqiyi.com/ivos/interact/video/data\? url-regex response-body ""
^https?://iface2.iqiyi.com/video/3.0/v_interface_proxy\? url-regex response-body ""
^https?://iface2.iqiyi.com/views_pop/3.0/pop_control\? url-regex response-body ""

[MITM]
hostname = *.iqiyi.com
